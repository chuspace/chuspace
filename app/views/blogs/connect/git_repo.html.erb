<div class='sm:w-2/3 w-full mx-auto'>
  <h3>Connect an existing blog</h3>
  <p class='text-secondary mt-2'>Simple three easy steps to get started</p>

  <div class="grid grid-cols-3 gap-4 my-8 w-full">
    <%= link_to 'Pick your Git Provider', connect_blog_path, class: "tab tab-bordered" %>
    <a class="tab tab-bordered tab-active">Pick a repository</a>
    <a class="tab tab-bordered ">Blog settings</a>
  </div>

  <h4>Choose a git repository</h4>
  <div class='mt-2 text-secondary'>
    <p>
      Connect an existing static site blog hosted on one of the
      linked Git providers.
      The selected Git repository must support publishing posts using markdown.
      <code>Example: Jekyll, Hugo or Astro</code>
    </p>
  </div>

  <details-menu-form>
    <section class='border-b border-base-300 pb-2 mt-8'>
      <%= simple_form_for('', url: git_provider_repos_path(@git_provider), html: { class: 'relative' }, method: :get, data: { target: 'details-menu-form.form', 'turbo-frame': dom_id(@git_provider, :repositories) }) do |form| %>
        <div class='flex items-center justify-between'>
          <details>
            <summary class='btn min-w-fit'>
              <div class='flex items-center' data-menu-button>
                <%= image_tag @git_provider.adapter.user.avatar_url, class: 'w-4 h-4 mask mask-circle mr-2' %>
                <%= content_tag :span, @git_provider.adapter.user.login %>
              </div>
            </summary>
            <details-menu
              role="menu"
              tabindex="0"
              class="p-2 shadow menu dropdown-content absolute z-10 bg-base-200 rounded-box w-52"
              data-action='details-menu-selected:details-menu-form#submit'
            >
              <% @git_provider.users.each do |user|%>
                <li tabindex="0" role="menuitem">
                  <input type="checkbox" name="login" value="<%= user.login %>" class='hidden' />
                  <a data-menu-button-contents class='flex items-center'/>
                    <%= image_tag user.avatar_url, class: 'w-4 h-4 mask mask-circle mr-2'  %>
                    <%= content_tag :span, user.login %>
                  </a>
                </li>
              <% end %>
            </details-menu>
          </details>

          <%= form.input :login, as: :hidden, input_html: { value: @git_provider.adapter.user.login, data: { target: 'details-menu-form.input' } } %>

          <div class="form-control w-1/3">
            <div class="relative">
              <%= form.input :query, label: false, wrapper: false, placeholder: 'Search repos', input_html: { class: 'w-full pr-16' } %>
              <%= form.submit 'Go', class: 'absolute top-0 right-0 rounded-l-none btn btn-primary' %>
            </div>
          </div>
        </div>
      <% end %>
    </section>

    <div class='mt-8 max-h-96 overflow-y-auto'>
      <%= turbo_frame_tag dom_id(@git_provider, :repositories), src: git_provider_repos_path(@git_provider, login: @git_provider.adapter.user.login), lazy: true, 'data-target': 'details-menu-form.loader' do %>
        <h5 class='text-center my-16'>Loading repositories...</h5>
      <% end %>
    </div>
  </details-menu-form>

  <div class='mt-8 flex items-center'>
    <span>Can't see your repo here?</span>
    <%= button_to 'Configure repository', '/auth/github_app', class: 'link link-primary ml-2', data: { turbo: false } %>
  </div>
</div>
