<% set_meta_tags @post %>

<% content_for(:header_actions) do %>
  <%= link_to 'Revision request', publication_post_revisions_path(@publication, @post), class: 'btn btn-info btn-xs mr-4', 'data-turbo-frame': :_top if allowed_to?(:revise?, @post) %>
<% end %>

<div class='sm:w-2/3 mx-auto w-full'>
  <%= render 'shared/breadcrumbs' %>

    <div class='flex justify-between items-center w-full bg-base-100 sticky top-0 z-10 py-2'>
      <div class='flex items-center flex-1 w-2/3'>
        <div class="avatar w-8 h-8">
          <%= image_tag(@post.author.avatar_url, class: 'mask mask-circle') %>
        </div>

        <div class='ml-4 w-2/3'>
          <h3><%= @post.author.name %></h3>
          <p class='text-secondary text-xs'>
            <%= @post.created_at.strftime("%d %b %Y %I:%M %p") %>
            <span class=''>.</span>
            <%= link_to @post.publication.personal? ? 'Personal' : @post.publication.name, publication_path(@post.publication) %>
          </p>
        </div>
      </div>

      <div class="flex justify-between items-center w-1/3">
        <% %w[facebook twitter email linkedin].each do |icon| %>
          <%= inline_svg_tag "icons/#{icon}.svg", class: 'w-4 h-4 fill-current cursor-pointer' %>
        <% end %>

        <%= link_to '#', class: '' do  %>
          <%= inline_svg_tag 'icons/bookmark.svg', class: 'w-4 h-4 fill-current' %>
        <% end %>

        <%= link_to '#', class: '' do  %>
          <%= inline_svg_tag 'icons/revision-request.svg', class: 'w-4 h-4 fill-current' %>
        <% end %>

        <%= link_to '#', class: '' do  %>
          <%= inline_svg_tag 'icons/comment-discussion.svg', class: 'w-4 h-4 fill-current' %>
        <% end %>

        <details class='dropdown dropdown-end'>
          <summary>
            <%= inline_svg_tag 'icons/smiley.svg', class: 'w-4 h-4 mx-auto fill-current' %>
          </summary>
          <details-menu
            role="menu"
            tabindex="0"
            src='<%= publication_post_reactions_path(@publication, @post) %>'
            class="p-2 shadow menu dropdown-content absolute z-10 bg-base-200 rounded-box w-52"
            data-action='details-menu-selected:details-menu-form#submit'
          >
            <include-fragment>
              <div class="text-center mt-4">
                <span class='btn btn-lg btn-ghost btn-circle loading'></span>
              </div>
            </include-fragment>
          </details-menu>
        </details>
      </div>



    </div>
  <div class='chu-editor'>
    <div class='my-8'>
      <%= content_tag :h1, @post.title, class: 'title' %>
      <%= content_tag :h2, @post.summary, class: 'summary' %>
    </div>

    <contribution-editor
      imageLoadPath='<%= publication_asset_path(@publication) %>'
      user='<%= Current.user.editor_attrs.to_json %>'
      contributions='<%= RevisionResource.new(@post.revisions.open).serialize %>'
      contributionsPath='<%= publication_post_revisions_path(@publication, @post) %>'
    >
      <%= text_area_tag 'post[content]', @post.draft.body, class: 'content hidden' %>
      <div id='contributions'></div>
    </contribution-editor>
  </div>
</div>
